include "cloudburst.sfp"

initial state {
	cloud1 isa Cloud
	cloud2 isa Cloud

	vm1 isa VM {
		running is true
		in_cloud = cloud1
	}
	vm2 isa VM {
		running is true
		in_cloud = cloud1
	}
	vm3 isa VM {
		running is true
		in_cloud = cloud1
	}
	ws1 isa WebService {
		running is true
		is_in = vm1
		depend is (app1)
	}
	app1 isa AppService {
		running is true
		is_in = vm2
		depend is (db1)
	}
	db1 isa DBService {
		running is true
		is_in = vm3
		depend is ()
	}

	vm4 isa VM {
		running is false
		in_cloud = cloud1
	}
	vm5 isa VM {
		running is false
		in_cloud = cloud1
	}
	vm6 isa VM {
		running is false
		in_cloud = cloud1
	}
	ws2 isa WebService {
		running is false
		is_in = vm4
		depend is (app2)
	}
	app2 isa AppService {
		running is false
		is_in = vm5
		depend is (db2)
	}
	db2 isa DBService {
		running is false
		is_in = vm6
		depend is ()
	}

	pc1 isa Client {
		refer = ws1
	}
	pc2 isa Client {
		refer = ws1
	}
}

goal {
	pc1.refer = ws1
	pc2.refer = ws1
	vm1.in_cloud = cloud2
	vm2.in_cloud = cloud2
	vm3.in_cloud = cloud2
	vm4.running is false
	vm5.running is false
	vm6.running is false

	always {
		forall (Service as s1) {
			if s1.running = true then s1.is_in.running = true

			forall (s1.depend as s2) {
				if s1.running = true then s2.running = true
			}
		}

		forall (Client as c) {
			c.refer.running = true
		}
	}
}
